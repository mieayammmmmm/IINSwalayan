@{
    ViewData["Title"] = "IIN Swalayan - Belanja Online Mudah & Terpercaya";
    var featuredProducts = ViewBag.FeaturedProducts as List<IINSwalayan.Models.Product> ?? new List<IINSwalayan.Models.Product>();
    var categories = ViewBag.Categories as List<IINSwalayan.Models.Category> ?? new List<IINSwalayan.Models.Category>();
}

<!-- Hero Section -->
<section class="hero-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 100px 0;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-4">
                    Belanja Kebutuhan Sehari-hari dengan <span class="text-warning">Mudah & Terpercaya</span>
                </h1>
                <p class="lead mb-4">
                    Dapatkan produk berkualitas dengan harga terbaik. Pengiriman cepat ke seluruh Indonesia.
                </p>
                <div class="d-flex gap-3">
                    <a href="@Url.Action("Products", "Home")" class="btn btn-warning btn-lg">
                        <i class="fas fa-shopping-cart"></i> Mulai Belanja
                    </a>
                    @if (!User.Identity.IsAuthenticated)
                    {
                        <a href="@Url.Action("Register", "Account")" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-user-plus"></i> Daftar Gratis
                        </a>
                    }
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <i class="fas fa-shopping-bag" style="font-size: 10rem; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
</section>

<!-- Login/Register Info for Guest -->
@if (!User.Identity.IsAuthenticated)
{
    <section class="py-3 bg-info text-white">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <strong><i class="fas fa-info-circle"></i> Belum punya akun?</strong>
                    Daftar sekarang untuk mulai berbelanja dan menikmati berbagai penawaran menarik!
                </div>
                <div class="col-md-4 text-end">
                    <a href="@Url.Action("Register", "Account")" class="btn btn-light btn-sm me-2">
                        <i class="fas fa-user-plus"></i> Daftar
                    </a>
                    <a href="@Url.Action("Login", "Account")" class="btn btn-outline-light btn-sm">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </a>
                </div>
            </div>
        </div>
    </section>
}

<!-- Categories Section -->
@if (categories.Any())
{
    <section class="py-5 bg-light">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="fw-bold">Kategori Produk</h2>
                <p class="text-muted">Temukan berbagai kategori produk yang Anda butuhkan</p>
            </div>
            <div class="row g-4">
                @foreach (var category in categories.Take(6))
                {
                    <div class="col-md-6 col-lg-4">
                        <a href="@Url.Action("Products", "Home", new { categoryId = category.Id })"
                           class="card h-100 text-decoration-none shadow-sm hover-card">
                            <div class="card-body text-center p-4">
                                @if (!string.IsNullOrEmpty(category.IconClass))
                                {
                                    <i class="@category.IconClass fa-3x text-primary mb-3"></i>
                                }
                                <h5 class="card-title text-dark">@category.Name</h5>
                                <p class="card-text text-muted">@category.Description</p>
                                <span class="badge bg-primary">@category.Products.Count(p => p.IsActive) Produk</span>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>
    </section>
}

<!-- Featured Products Section -->
@if (featuredProducts.Any())
{
    <section class="py-5">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h2 class="fw-bold">Produk Terbaru</h2>
                    <p class="text-muted">Produk-produk terbaru dan terpopuler</p>
                </div>
                <a href="@Url.Action("Products", "Home")" class="btn btn-outline-primary">
                    Lihat Semua <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="row g-4">
                @foreach (var product in featuredProducts)
                {
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100 shadow-sm hover-card">
                            <div class="position-relative">
                                @if (!string.IsNullOrEmpty(product.ImageUrl))
                                {
                                    <img src="@product.ImageUrl" alt="@product.Name"
                                         class="card-img-top" style="height: 200px; object-fit: cover;">
                                }
                                else
                                {
                                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center"
                                         style="height: 200px;">
                                        <i class="fas fa-image fa-3x text-muted"></i>
                                    </div>
                                }
                                @if (product.Stock <= 10 && product.Stock > 0)
                                {
                                    <span class="badge bg-warning position-absolute top-0 end-0 m-2">Stok Terbatas</span>
                                }
                                @if (product.Stock == 0)
                                {
                                    <span class="badge bg-danger position-absolute top-0 end-0 m-2">Habis</span>
                                }
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h6 class="card-title">@product.Name</h6>
                                @if (!string.IsNullOrEmpty(product.Description))
                                {
                                    <p class="card-text text-muted small">
                                        @(product.Description.Length > 60 ?
                                                                    product.Description.Substring(0, 60) + "..." :
                                                                    product.Description)
                        </p>
                                                }
                                <div class="mt-auto">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 class="text-primary mb-0">Rp @product.Price.ToString("N0")</h5>
                                        @if (product.Category != null)
                                        {
                                            <span class="badge bg-secondary">@product.Category.Name</span>
                                        }
                                    </div>
                                    <div class="d-flex gap-2">
                                        <a href="@Url.Action("ProductDetail", "Home", new { id = product.Id })"
                                           class="btn btn-outline-primary btn-sm flex-grow-1">
                                            <i class="fas fa-eye"></i> Detail
                                        </a>
                                        @if (User.Identity.IsAuthenticated)
                                        {
                                            @if (product.Stock > 0)
                                            {
                                                <button onclick="addToCart(@product.Id)" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-cart-plus"></i>
                                                </button>
                                            }
                                            else
                                            {
                                                <button class="btn btn-secondary btn-sm" disabled>
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            }
                                        }
                                        else
                                        {
                                            <a href="@Url.Action("Login", "Account")" class="btn btn-primary btn-sm" title="Login untuk Beli">
                                                <i class="fas fa-cart-plus"></i>
                                            </a>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </section>
}

<!-- Features Section -->
<section class="py-5 bg-primary text-white">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Mengapa Memilih IIN Swalayan?</h2>
            <p class="mb-0">Kami berkomitmen memberikan pengalaman belanja terbaik</p>
        </div>
        <div class="row g-4">
            <div class="col-md-6 col-lg-3 text-center">
                <div class="bg-white text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                     style="width: 80px; height: 80px;">
                    <i class="fas fa-shipping-fast fa-2x"></i>
                </div>
                <h5>Pengiriman Cepat</h5>
                <p>Pengiriman same day untuk area tertentu</p>
            </div>
            <div class="col-md-6 col-lg-3 text-center">
                <div class="bg-white text-success rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                     style="width: 80px; height: 80px;">
                    <i class="fas fa-shield-alt fa-2x"></i>
                </div>
                <h5>Produk Berkualitas</h5>
                <p>Produk original dan berkualitas tinggi</p>
            </div>
            <div class="col-md-6 col-lg-3 text-center">
                <div class="bg-white text-warning rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                     style="width: 80px; height: 80px;">
                    <i class="fas fa-money-bill-wave fa-2x"></i>
                </div>
                <h5>Cash on Delivery</h5>
                <p>Bayar saat barang diterima</p>
            </div>
            <div class="col-md-6 col-lg-3 text-center">
                <div class="bg-white text-info rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                     style="width: 80px; height: 80px;">
                    <i class="fas fa-headset fa-2x"></i>
                </div>
                <h5>Customer Service</h5>
                <p>Dukungan pelanggan 24/7</p>
            </div>
        </div>
    </div>
</section>

<!-- Call to Action -->
@if (!User.Identity.IsAuthenticated)
{
    <section class="py-5 bg-light">
        <div class="container text-center">
            <h3 class="fw-bold mb-3">Siap Mulai Berbelanja?</h3>
            <p class="text-muted mb-4">Daftar sekarang dan nikmati pengalaman belanja yang mudah dan menyenangkan!</p>
            <div class="d-flex gap-3 justify-content-center">
                <a href="@Url.Action("Register", "Account")" class="btn btn-primary btn-lg">
                    <i class="fas fa-user-plus"></i> Daftar Gratis
                </a>
                <a href="@Url.Action("Products", "Home")" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-eye"></i> Lihat Produk
                </a>
            </div>
        </div>
    </section>
}

<style>
    .hover-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
            text-decoration: none;
        }

    .hero-section {
        background-attachment: fixed;
    }
</style>

<script>
    // Add to cart function
    function addToCart(productId, quantity = 1) {
        fetch('@Url.Action("AddToCart", "Cart")', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
            },
            body: `productId=${productId}&quantity=${quantity}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                updateCartCount(data.cartCount);
                showAlert('success', data.message);
            } else {
                showAlert('danger', data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showAlert('danger', 'Terjadi kesalahan saat menambahkan produk ke keranjang.');
        });
    }

    function updateCartCount(count) {
        const cartBadge = document.querySelector('.cart-badge');
        if (cartBadge) {
            cartBadge.textContent = count;
        }
    }

    function showAlert(type, message) {
        const alertHtml = `
            <div class="alert alert-${type} alert-dismissible fade show position-fixed"
                 style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" role="alert">
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', alertHtml);

        setTimeout(() => {
            const alert = document.querySelector('.alert');
            if (alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            }
        }, 5000);
    }

    // Load cart count on page load
    document.addEventListener('DOMContentLoaded', function() {
        @if (User.Identity.IsAuthenticated)
        {
                <text>
                fetch('@Url.Action("GetCartCount", "Cart")')
                    .then(response => response.json())
                    .then(data => {
                        updateCartCount(data.cartCount);
                    })
                    .catch(error => console.error('Error loading cart count:', error));
                </text>
        }
    });
</script>

@Html.AntiForgeryToken()